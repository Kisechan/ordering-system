# 数据库模块说明（schema.md）

## 1. 模块概述

本项目将数据库相关代码统一放在 `database/` 目录下，用于完成数据库连接管理、数据表的增删改查以及基础业务逻辑处理。  
该模块与界面逻辑解耦，仅向上层提供稳定的数据与业务服务。

---

## 2. 目录结构说明

```
db/
├── DbManager.*        # 数据库连接管理
├── dao/               # 数据访问层（DAO）
├── service/           # 业务逻辑层（Service）
├── entity/            # 数据实体定义
└── db.pri             # Qt 工程包含配置
```

---

## 3. DbManager（数据库连接管理）

`DbManager` 负责统一管理数据库连接，主要功能包括：

- 初始化并打开数据库连接（通过 ODBC 连接 MariaDB / MySQL）
- 维护 `QSqlDatabase` 实例
- 向 DAO 和 Service 层提供可用的数据库连接

该类采用单例模式，避免重复创建数据库连接。

---

## 4. DAO 层（数据访问层）

DAO 层与数据库表一一对应，仅负责**数据访问操作（CRUD）**，不包含业务逻辑。

### 设计原则
- DAO 不处理业务规则
- DAO 不保存业务状态
- DAO 不处理事务
- DAO 方法统一返回 `QJsonObject`

### 返回数据格式

```json
{
  "code": 200,
  "msg": "",
  "data": ...
}
```

DAO 仅保证 SQL 正确执行，不对业务含义作判断。

---

## 5. Service 层（业务逻辑层）

Service 层用于实现系统业务逻辑，例如：

- 用户登录与注册校验
- 下单及订单事务处理
- 订单评价
- 管理员订单查询等

Service 层通过调用 DAO 获取数据，并根据业务规则返回最终结果，统一返回 `QJsonObject`。

---

## 6. entity 层（数据实体）

entity 层用于定义系统中的数据结构，如 `User`、`DishCount`、`Order` 等。  
实体类仅用于数据封装和传递，不直接进行数据库操作。

---

## 7. 设计总结

本模块采用 **DbManager + DAO + Service** 的分层设计：

- DbManager 负责数据库连接管理
- DAO 层负责数据访问
- Service 层负责业务逻辑
- 返回数据统一使用 `QJsonObject`

该设计结构清晰，职责明确，便于维护和扩展。
